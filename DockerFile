# Gunakan image resmi PHP 8.2 dengan Apache
FROM php:8.2-apache

# Instal ekstensi PHP yang dibutuhkan oleh Laravel
RUN docker-php-ext-install pdo pdo_mysql

# Set working directory di dalam container
WORKDIR /var/www/html

# Salin semua file proyek ke dalam container
COPY . .

# Jalankan composer install
# Pertama, dapatkan Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer
# Jalankan instalasi dependensi
RUN composer install --no-dev --optimize-autoloader

# Salin file .env.production ke .env (jika ada) atau setup env
# Kita akan handle ini melalui Render Environment Variables, jadi langkah ini bisa dilewati

# Atur kepemilikan file agar Apache bisa menulis ke storage
RUN chown -R www-data:www-data /var/www/html/storage /var/www/html/bootstrap/cache

# Expose port 80 yang digunakan oleh Apache
EXPOSE 80